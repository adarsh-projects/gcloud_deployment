from flask import Flask, request, jsonify, render_template
#from  import RecomdModel
import pandas as pd
import numpy as np
import json
import tensorflow as tf
from tensorflow import keras


app = Flask("__name__")

model = keras.models.load_model("//home//adarsh//Desktop//Flask//abcd//")
model.summary()

@app.errorhandler(404)
def not_found(error):
    return "<h2>404</h2><p>Nahi Mila</p>"

@app.route('/')
def apitest():
	return render_template('index.html', query="")

@app.route('/predict', methods=['POST'])
def predict():
	query = [ x for x in request.form.values()]
	
	p_id = [1, 2, 3, 5, 6, 8, 10, 11, 13, 21, 24, 25, 26, 27, 28, 29, 30, 33, 34, 36, 50, 67, 93, 98, 105, 106, 112, 117, 119, 122, 231, 249, 250, 264, 275, 291, 295, 304, 320, 343, 348, 350, 353, 355, 357, 359, 360, 365, 378, 386, 400, 415, 424, 428, 431, 432, 446, 447, 449, 456, 475, 597, 599, 621, 629, 647, 656, 662, 665, 667, 668, 676, 698, 703, 706, 760, 771, 816, 822, 823, 825, 827, 830, 840, 865, 870, 880, 890, 900, 902, 903, 930, 952, 960, 968, 976, 998, 1005, 1032, 1052, 1067, 1078, 1097, 1103, 1110, 1171, 1191, 1192, 1202, 1232, 1241, 1274, 1295, 1301, 1303, 1305, 1307, 1319, 1362, 1371, 1375, 1381, 1420, 1426, 1427, 1428, 1430, 1431, 1519, 1524, 1540, 1554, 1591, 1617, 1618, 1622, 1624, 1625, 1627, 1633, 1635, 1715, 1823, 1824, 1842, 1845, 1846, 1848, 1849, 1852, 1869, 1875, 1885, 1897, 1898, 1911, 1934, 1953, 1990, 2002, 2049, 2050, 2052, 2054, 2067, 2068, 2094, 2095, 2122, 2137, 2142, 2152, 2156, 2159, 2165, 2175, 2183, 2187, 2199, 2203, 2255, 2265, 2279, 2368, 2371, 2372, 2373, 2430, 2442, 2493, 2517, 2526, 2528, 2530, 2547, 2612, 2615, 2623, 2657, 2666, 2677, 2696, 2715, 2743, 2744, 2748, 2767, 2784, 2794, 2839, 2865, 2872, 2873, 2879, 2880, 2915, 2932, 2956, 2978, 2998, 3008, 3028, 3049, 3061, 3087, 3102, 3103, 3109, 3110, 3273, 3291, 3300, 3304, 3368, 3378, 3379, 3381, 3384, 3388, 3412, 3431, 3446, 3447, 3462, 3463, 3464, 3465, 3466, 3467, 3473, 3476, 3478, 3483, 3507, 3559, 3562, 3579, 3581, 3586, 3590, 3636, 3648, 3656, 3679, 3682, 3685, 3686, 3690, 3692, 3698, 3710, 3711, 3717, 3750, 3757, 3758, 3759, 3760, 3762, 3763, 3764, 3805, 3832, 3836, 3858, 3867, 3869, 3872, 3873, 3876, 3882, 3885, 3888, 3895, 3972, 3973, 3974, 3977, 3980, 3985, 4004, 4005, 4006, 4008, 4009, 4031, 4035, 4069, 4076, 4099, 4122, 4135, 4136, 4137, 4138, 4143, 4214, 4261, 4264, 4268, 4271, 4325, 4339, 4364, 4373, 4381, 4395, 4406, 4407, 4473, 4477, 4507, 4516, 4530, 4538, 4588, 4591, 4599, 4600, 4625, 4630, 4631, 4633, 4645, 4652, 4656, 4657, 4659, 4660, 4662, 4671, 4687, 4692, 4701, 4708, 4796, 4799, 4806, 4813, 4820, 4830, 4835, 4865, 4866, 4887, 4894, 4898, 4900, 4909, 4912, 4921, 4929, 4934, 4948, 4950, 4952, 4953, 4954, 4955, 4965, 4978, 4979, 4980, 4981, 4982, 4983, 4984, 4985, 4986, 4987, 4989, 5015, 5038, 5043, 5052, 5053, 5055, 5062, 5064, 5068, 5084, 5091, 5093, 5094, 5096, 5107, 5113, 5114, 5128, 5129, 5130, 5139, 5148, 5157, 5158, 5159, 5160, 5161, 5166, 5167, 5168, 5171, 5174, 5175, 5176, 5179, 5180, 5181, 5182, 5186, 5187, 5190, 5191, 5196, 5197, 5198, 5203, 5204, 5205, 5211, 5246, 5289, 5296, 5297, 5306, 5308, 5326, 5338, 5344, 5345, 5346, 5347, 5348, 5349, 5350, 5351, 5352, 5354, 5355, 5356, 5357, 5358, 5359, 5360, 5364, 5367, 5368, 5369, 5413, 5417, 5439, 5452, 5453, 5454, 5472, 5479, 5481, 5508, 5509, 5517, 5526, 5527, 5544, 5548, 5552, 5553, 5559, 5571, 5575, 5659, 5693, 5695, 5697, 5720, 5752, 5755, 5759, 5787, 5797, 5805, 5809, 5826, 5845, 5849, 5872, 5890, 5907, 5932, 5936, 5942, 5946, 5954, 6138, 6149, 6150, 6159, 6174, 6185, 6192, 6193, 6194, 6259, 6288, 6294, 6295, 6310, 6319, 6327, 6328, 6334, 6419, 6420, 6422, 6423, 6424, 6425, 6426, 6427, 6440, 6462, 6514, 6520, 6526, 6528, 6530, 6531, 6534, 6537, 6538, 6539, 6541, 6551, 6554, 6572, 6588, 6596, 6613, 6614, 6628, 6656, 6667, 6670, 6671, 6678, 6687, 6689, 6690, 6693, 6694, 6697, 6708, 6709, 6748, 6749, 6750, 6751, 6753, 6759, 6819, 6820, 6853, 6854, 6858, 6862, 6867, 6870, 6872, 6882, 6900, 6952, 6969, 6976, 7035, 7036, 7039, 7053, 7058, 7061, 7062, 7069, 7073, 7081, 7082, 7126, 7144, 7184, 7186, 7190, 7194, 7199, 7201, 7214, 7244, 7252, 7329, 7332, 7354, 7389, 7432, 7433, 7437, 7442, 7445, 7455, 7493, 7494, 7510, 7520, 7531, 7572, 7579, 7588, 7603, 7604, 7613, 7624, 7628, 7661, 7663, 7667, 7668, 7669, 7670, 7672, 7673, 7675, 7677, 7679, 7682, 7707, 7714, 7723, 7728, 7733, 7742, 7745, 7748, 7763, 7769, 7770, 7779, 7780, 7784, 7785, 7788, 7797, 7805, 7815, 7869, 7882, 7909, 7911, 7926, 7967, 7968, 7973, 7979, 7980, 7981, 7983, 7987, 7993, 7996, 7998, 7999, 8073, 8087, 8088, 8089, 8127, 8155, 8172, 8248, 8252, 8253, 8282, 8296, 8337, 8492, 8515, 8600, 8646, 8647, 8648, 8650, 8676, 8680, 8682, 8694, 8695, 8696, 8698, 8725, 8732, 8745, 8765, 8852, 8908, 8909, 8921, 8948, 8949, 8951, 8952, 8953, 8957, 8960, 8962, 8963, 8964, 8965, 8966, 8967, 8968, 9010, 9013, 9014, 9282, 9298, 9300, 9301, 9302, 9303, 9328, 9355, 9370, 9375, 9416, 9417, 9418, 9419, 9420, 9454, 9475, 9503, 9516, 9517, 9522, 9526, 9530, 9531, 9532, 9534, 9539, 9549, 9555, 9557, 9566, 9567, 9569, 9570, 9589, 9590, 9592, 9593, 9594, 9595, 9597, 9598, 9601, 9646, 9648, 9650, 9654, 9712, 9717, 9742, 9762, 9777, 9784, 9791, 9799, 9804, 9809, 9820, 9822, 9827, 9833, 9838, 9844, 9854, 9864, 9865, 9912, 9913, 9914, 9915, 9943, 9957, 9998]
	product_arr = np.array(p_id) #get all book IDs
	
	user = int(query[0])
	rating = int(query[1])
	sex = int(query[2])
	
	user = np.array([ user for i in range(810)])
	ratings = np.array([ rating for i in range(810)])
	sex = np.array([ sex for i in range(810)])

	# user rating sex
	prediction = model.predict([product_arr, user, ratings, sex])	
	prediction = prediction.reshape(-1) #reshape to single dimension
	pred_ids = (-prediction).argsort()[0:5]
	
	#value = model.predictModel(180, 3, 327)
	
	value = {"brand": [int(x) for x in pred_ids]}
	#value = {"brand": list(pred_ids) }
	return value #{"item": "hey Adarsh"}
	#return {"item": "Hey, Adarsh"}

if __name__ == '__main__':
	app.run()
